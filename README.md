![GitHub Downloads (all assets, all releases)](https://img.shields.io/github/downloads/SenseiMori/PicTweak/total)
![GitHub commit activity](https://img.shields.io/github/commit-activity/y/SenseiMori/PicTweak)
[![Telegram](https://img.shields.io/badge/Telegram-Sensei__Mori-2CA5E0?style=flat&logo=telegram)](https://t.me/Sensei_Mori)
[![ImageSharp](https://img.shields.io/badge/ImageSharp-GitHub-a4a61d?style=flat&logo=github)](https://github.com/SixLabors/ImageSharp)
[![EXIFRemover](https://img.shields.io/badge/EXIFRemover-GitHub-97CA00?style=flat&logo=github)](https://github.com/SenseiMori/EXIFRemover)

# Что это такое
PicTweak — небольшое приложение, с помощью которого можно сделать финальную правку изображений. Например, сжать до нужного размера, изменить разрешение или удалить метаданные. Функции работают как отдельно друг от друга, так и все вместе.

# Как этим пользоваться
1. Выберите папку, в которой лежат изображения для обработки;
2. В верхнем меню выберите пункт "Быстрая настройка" и нужные параметры обработки;
3. Нажмите "Сохранить измененные изображения".
![pic](https://github.com/user-attachments/assets/bbb902f7-51f0-4a7b-9850-da880086ff74)
___
Перед сохранением вы можете узнать разрешение и вес файла, которые будут на выходе. Эти значения находятся под миниатюрой и меняются динамически в зависимости от выбранной опции.
Изображения сохраняются в новой папке каталога, из которого взяты исходники.

# Особенности и ограничения
На данный момент приложение работает только с форматом .jpg/.jpeg. Доступен выбор только всей папки, но не отдельных изображений. При этом в папке могут находиться файлы других расширений, приложение самостоятельно выберет .jpg/.jpeg. Итоговые файлы сохраняются только в корневую папку.

# Как это работает

Идея проста и реализована через паттерн "стратегия": есть три обработчика, отвечающие за изм. разрешения, веса файла, удаление EXIF данных. Согласно паттерну (и для унификации и расширяемости) они на входе принимают массив байтов и возвращают также массив байтов, но уже обработанный.

Для корректного отображения в UI используется модель MyImage, которая имеет такие свойства, как имя файла, вес, размер, список маркеров и так далее. Через свойство "string FilePath" обработчики получают путь до файла и уже внутри себя читают его побайтово и производят соответствующие им операции: 

- Сжатие файла и изм. разрешения выполняются через зависимость ImageSharp.

- Удаление EXIF через зависимость EXIFRemover.

В библиотеке EXIFRemover реализованы два метода: Удаление маркеров APP0-APP15 + COM, что гарантировано "чистит" jpg от метаданных и записей от графических редакторов, и поиск маркеров. Также реализован дополнительный метод конвертирования Big endian в Little endian для корректной работы основных функций, так как встроенные c# методы (например, ReadUInt16) возвращают "неудобный" Big endian.


Обработчики вызываются "дирижером" — методом, который компонует итоговый файл в новую папку.

# Известные проблемы с производительностью

- Для полей модели MyImage "ExpectedWidthHeight" и "ExpectedSize" необходимо проводить ресайз и сжатие в реальном времени. Проще говоря, если в UI выбрать уровень сжатия, то приложение сожмет все изображения в коллекции и отобразит измененные поля в UI. Это происходит из-за особенностей алгоритмов сжатия: изображения весят по-разному, и рассчитать их вес по какой-то формуле невозможно. 

- Сильная зависимость "количество изображений = потребеление памяти".

- Мелкие утечки памяти.

# Дорожная карта
- Расширить пул форматов до .png;
- Добавить возможность одного или нескольких изображений для обработки;
- Добавить возможность обработки через контекстное меню Windows;
- Добавить возможность сохранения итоговых изображений в архив;
- Оптимизировать потребление памяти;
- Улучшить UX/UI: добавить выбор темной темы, сделать более приятный визуальный стиль окна, плиток, кнопок.

# Связь с разработчиком
По всем вопросам https://t.me/Sensei_Mori
